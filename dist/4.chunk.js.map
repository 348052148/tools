{"version":3,"sources":["webpack:///./src/views/message.vue","webpack:///message.vue","webpack:///./src/views/message.vue?10f5","webpack:///./src/views/message.vue?28dd"],"names":[],"mappings":";;;;;;AACA;AACA,sBAAyT;;AAEzT;AACA;AACA;AACA;AACA,wBAAsH;AACtH;AACA;AACA;AACA;AACA;AACA;AACA,+EAA+E,iDAAiD,IAAI;AACpI,mCAAmC;;AAEnC;AACA,YAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,CAAC;;AAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACwLA;AACA;AACA;AACA;0BAEA;;oBAEA;uBAEA;;gBACA;sBACA;qBACA;uBACA;sBACA;0BACA;sBAEA;AAXA;AAYA;;AACA;;AACA;4CAEA;;;oCAEA;AADA,8BAGA,CACA;AAEA;;AACA;wBACA;0FACA;yGACA;4BACA;AAGA;;AACA;+GACA;wBACA;wBACA;6DACA;2CACA;4BACA;AACA;AACA;yBACA;+DAEA;;mCAIA;AAHA;AAFA;AAQA;AACA;;;;AAEA;;oBACA;gEAEA;;8CACA;wBACA;0CACA;AACA;AACA;6CACA;uBACA;AACA;8CACA;AAEA;AAfA;;AAiBA;8CAEA,CACA;;AACA;wCAEA,CACA;;AACA;;AACA;;2IACA;4BACA;6CACA;AACA;AACA;AACA;AACA;AAEA;AAEA;;;AACA;sDACA;yBAEA;;kDAEA;;6CACA;6BACA;AACA;AACA;AAEA;;mBACA;AACA;;AACA;wDACA;sCACA;gCACA;AACA;mBACA;AACA;;AACA;8CAEA;;qCACA;sCACA;uBACA;AAEA;;;oCAEA;+DACA;8BACA;AAHA,8BAKA,CAEA;;8DACA;0CAEA;;+BAKA;AAJA;AAFA;4BAOA;AACA;;AACA;8CACA;kCACA;4BACA;6BACA;AAEA;AA3EA;AAtEA,G;;;;;;;AC3NA,yC;;;;;;;ACAA,gBAAgB,mBAAmB,aAAa,0BAA0B;AAC1E;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL,GAAG;AACH;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA,C","file":"4.chunk.js","sourcesContent":["\n/* styles */\nrequire(\"!!../../node_modules/_extract-text-webpack-plugin@2.1.2@extract-text-webpack-plugin/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?minimize!../../node_modules/_vue-loader@11.3.4@vue-loader/lib/style-compiler/index?{\\\"id\\\":\\\"data-v-4e0c4c68\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!autoprefixer-loader!less-loader!../../node_modules/_vue-loader@11.3.4@vue-loader/lib/selector?type=styles&index=0!../../node_modules/_iview-loader@1.0.0@iview-loader/index.js??ref--0-1!./message.vue\")\n\nvar Component = require(\"!../../node_modules/_vue-loader@11.3.4@vue-loader/lib/component-normalizer\")(\n  /* script */\n  require(\"!!babel-loader!../../node_modules/_vue-loader@11.3.4@vue-loader/lib/selector?type=script&index=0!../../node_modules/_iview-loader@1.0.0@iview-loader/index.js??ref--0-1!./message.vue\"),\n  /* template */\n  require(\"!!../../node_modules/_vue-loader@11.3.4@vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-4e0c4c68\\\"}!../../node_modules/_vue-loader@11.3.4@vue-loader/lib/selector?type=template&index=0!../../node_modules/_iview-loader@1.0.0@iview-loader/index.js??ref--0-1!./message.vue\"),\n  /* scopeId */\n  \"data-v-4e0c4c68\",\n  /* cssModules */\n  null\n)\nComponent.options.__file = \"D:\\\\webproject\\\\iview-project\\\\src\\\\views\\\\message.vue\"\nif (Component.esModule && Object.keys(Component.esModule).some(function (key) {return key !== \"default\" && key !== \"__esModule\"})) {console.error(\"named exports are not supported in *.vue files.\")}\nif (Component.options.functional) {console.error(\"[vue-loader] message.vue: functional components are not supported with templates, they should use render functions.\")}\n\n/* hot reload */\nif (module.hot) {(function () {\n  var hotAPI = require(\"vue-loader/node_modules/vue-hot-reload-api\")\n  hotAPI.install(require(\"vue\"), false)\n  if (!hotAPI.compatible) return\n  module.hot.accept()\n  if (!module.hot.data) {\n    hotAPI.createRecord(\"data-v-4e0c4c68\", Component.options)\n  } else {\n    hotAPI.reload(\"data-v-4e0c4c68\", Component.options)\n  }\n})()}\n\nmodule.exports = Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/message.vue\n// module id = 24\n// module chunks = 4","<style scoped lang=\"less\">\r\n    .message{\r\n        width: 100%;\r\n        flex-direction: row;\r\n    }\r\n\r\n    .msg-window{\r\n        width:68%;\r\n        height:100%;\r\n        float:right;\r\n        display:inline-block;\r\n    }\r\n\r\n    .msg-list-swrip {\r\n        width:30%;\r\n        height:450px;\r\n        float:left;\r\n        display:inline-block;\r\n        list-style:none;\r\n        background:#fff;\r\n        border:1px solid #eee;\r\n         position: relative;\r\n        overflow: hidden;\r\n         \r\n    }\r\n\r\n    .message .chat{\r\n        width:100%;\r\n        padding:10px;\r\n\r\n        \r\n    }\r\n\r\n   .message .chat::-webkit-scrollbar {\r\n        display: none;\r\n    }\r\n\r\n    .msg-mode {\r\n        width:100%;\r\n        padding:5px;\r\n        border:1px solid #eee;\r\n    }\r\n    .msg-mode .user-info{\r\n        display:inline-block;\r\n        width:100%;\r\n        margin-bottom:5px;\r\n    }\r\n    .msg-mode .msg-content{\r\n        width:100%;\r\n        flex-direction:column;\r\n        display:flex;\r\n        padding-left:30px;\r\n        font-size:14px;\r\n    }\r\n\r\n    .slef-mode{\r\n        width:100%;\r\n        padding:5px;\r\n        border:1px solid #eee;\r\n    }\r\n    .slef-mode .user-info {\r\n         padding-right:10px;\r\n         text-align:right;\r\n         line-height:32px;\r\n         display:inline-block;\r\n        width:100%;\r\n        margin-bottom:5px;\r\n    }\r\n    .slef-mode .user-info img{\r\n        float:right;\r\n        margin-left:10px;\r\n    }\r\n    .slef-mode .user-info span{\r\n        float:right;\r\n    }\r\n    .slef-mode .user-info{\r\n        flex-direction:column-reverse;\r\n    }\r\n    .slef-mode .msg-content{\r\n        text-align:right;\r\n        padding-right:30px;\r\n        width:100%;\r\n        font-size:14px;\r\n    }\r\n    \r\n\r\n\r\n    .msg-list-swrip {\r\n        width:30%;\r\n        height:450px;\r\n        float:left;\r\n        display:inline-block;\r\n        list-style:none;\r\n        background:#fff;\r\n        border:1px solid #eee;\r\n         position: relative;\r\n        overflow: hidden;\r\n         \r\n    }\r\n    .msg-list::-webkit-scrollbar {\r\n        display: none;\r\n    }\r\n    .msg-list {\r\n        width:100%;\r\n        height:100%;\r\n         position: absolute; left: 0;\r\n        overflow-x: hidden;\r\n         overflow-y: scroll;\r\n    }\r\n\r\n    .msg-list .ul{\r\n        display:inline-block;\r\n        height:100%;\r\n        \r\n    }\r\n\r\n     .msg-list ul li{\r\n        display:inline-block;\r\n        height:40px;\r\n        width:100%;\r\n        line-height:40px;\r\n        padding-left:10px;\r\n         border-bottom:1px solid #eee;\r\n        \r\n    }\r\n     .msg-list ul li:hover{\r\n         background:#eee;\r\n         cursor:pointer;\r\n         border-bottom:3px solid #54234;\r\n     }\r\n      .msg-list ul .search{\r\n          padding-left:3px;\r\n          padding-right:3px;\r\n     }\r\n\r\n     .demo-badge-alone{\r\n         margin-left:20px;\r\n         display:inline-block;\r\n         float:right;\r\n         margin-top:10px;\r\n         margin-right:10px;\r\n    }\r\n\r\n    /**搜索 */\r\n    .optionSearch{\r\n        width:100%;\r\n        display:inline-block;\r\n    }\r\n    .optionSearch .complete-title{\r\n        display:inline-block;\r\n    }\r\n    .optionSearch .complete-add {\r\n        display:inline-block;\r\n        float:right;\r\n    }\r\n    .biao{\r\n        font-size:10px;\r\n        text-align:center;\r\n    }\r\n</style>\r\n<template>\r\n    <div class=\"message\">\r\n        <div class=\"msg-list-swrip\">\r\n        <div class=\"msg-list\">\r\n            <ul>\r\n                <li class=\"search\">\r\n                <AutoComplete\r\n                    icon=\"search\"\r\n                    v-model=\"search\"\r\n                    @on-search=\"handleSearch\"\r\n                    @on-select=\"selectFriend\"\r\n                    placeholder=\"搜索\">\r\n                        <Option class=\"optionSearch\" v-for=\"friend in searchLst\" :value=\"friend.nickname\" :key=\"friend.id\">\r\n                            <span class=\"complete-title\">{{ friend.nickname }}</span>\r\n                            <span @click=\"addFriend\" class=\"complete-add\"><Icon type=\"plus-round\"></Icon></span>\r\n                        </Option>\r\n\r\n                    <a target=\"_blank\" class=\"biao\">好友搜索</a>\r\n\r\n                </AutoComplete></li>\r\n                <li v-for=\"user in userInfo.friendLst\" v-if=\"user.id!=userInfo.id\"  :style=\"currentUserStyle(user.id)\" @click=\"selectUser(user)\"  >\r\n                    <Avatar src=\"https://i.loli.net/2017/08/21/599a521472424.jpg\" />\r\n                    &nbsp;&nbsp;{{user.nickname}}\r\n                    <Badge class=\"demo-badge-alone\" :count=\"unreadMsgCount(user)\">\r\n                    </Badge>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n        </div>\r\n\r\n        <div class=\"msg-window\" v-if=\"isActive==true\">\r\n        <Scroll :style=\"{background:'#fff',marginBottom:'10px'}\" :height=\"400\" class=\"chat\" >\r\n            <ul>\r\n                <li v-for=\"msg in getUserMsg\" :class=\"msg.ismster?'slef-mode':'msg-mode'\">\r\n                    <div class=\"user-info\"><Avatar src=\"https://i.loli.net/2017/08/21/599a521472424.jpg\" />&nbsp;&nbsp;{{msg.user.nickname}}&nbsp;&nbsp;</div>\r\n                    <div class=\"msg-content\" :data=\"msg.read=true\" >\r\n                        {{msg.content.text}} \r\n                        <img v-for=\"img in msg.content.imgs\" width=\"300\" :src=\"img\"/>\r\n                    </div>\r\n                </li>\r\n            </ul>\r\n        </Scroll>\r\n     \r\n        <Input @on-enter=\"inputMessage\" v-model=\"inputMsg\" placeholder=\"输入发送内容\" clearable style=\"width: 300px\"></Input>\r\n\r\n        <i-button type=\"primary\" shape=\"circle\">发送</i-button>\r\n        </div>\r\n\r\n        <div v-else  class=\"msg-window\">\r\n\r\n        </div>\r\n\r\n    </div>\r\n</template>\r\n<script>\r\n    import util from '../libs/util.js';\r\n    import user from '../libs/user.js';\r\n    import socket from '../libs/socket.js';\r\n    export default {\r\n        data(){\r\n            return {\r\n                search:'',\r\n                searchLst:[],\r\n\r\n                ws:{},\r\n                userInfo:{},\r\n                userLst:[],\r\n                currentId:0,\r\n                isActive:false,\r\n                currentIndex:0,\r\n                inputMsg:''\r\n            }\r\n        },\r\n        created(){\r\n            //页面关闭时释放消息连接\r\n            window.onbeforeunload = ()=> {\r\n\r\n                  socket.request('user.logout',{\r\n                      uid:this.userInfo.id\r\n                  },(msg)=>{\r\n                    \r\n                  });\r\n            };\r\n           \r\n            // 好友信息处理 包括聊天记录\r\n            this.userInfo = user;\r\n            if(user.friendLst > 1) {\r\n                this.currentId = user.friendLst[0].id;\r\n                this.isActive = true;\r\n            }\r\n            \r\n\r\n            //监听消息\r\n            socket.listen('message.recv',(msg)=>{\r\n                 console.log(msg);\r\n                    let index = null;\r\n                    this.userInfo.friendLst.forEach((v,i)=>{\r\n                        if(v.id == msg.data.from){\r\n                            index = i;\r\n                        }\r\n                    });\r\n                    if(index!=null)\r\n                    this.userInfo.friendLst[index].msgLst.push({\r\n                        ismster:false,user:this.userInfo.friendLst[index],\r\n                        content:{\r\n                            text:msg.data.content\r\n                        }\r\n                    });\r\n            });\r\n\r\n           \r\n        },\r\n        computed: {\r\n            getUserMsg(){\r\n                let i =0;\r\n                this.userInfo.friendLst.forEach((v,index)=>{\r\n                    \r\n                    if(v.id == this.currentId){\r\n                        i = index;\r\n                        this.currentIndex = index;\r\n                    }\r\n                });\r\n                if(!this.userInfo.friendLst[i]){\r\n                    return [];\r\n                }\r\n                return this.userInfo.friendLst[i].msgLst;\r\n            }\r\n        },\r\n        methods: {\r\n            //选择好友\r\n            selectFriend(){\r\n\r\n            },\r\n            //添加好友\r\n            addFriend(){\r\n\r\n            },\r\n            //处理搜索\r\n            handleSearch(value){\r\n                socket.request('user.find.list',{keyword:value},(data)=>{\r\n                    console.log(data);\r\n                    this.searchLst = data.data.list;\r\n                    // this.searchLst = [];\r\n                    // data.data.list.forEach((v)=>{\r\n                    //     this.searchLst.push(v.nickname);\r\n                    // });\r\n                });\r\n                \r\n            },\r\n\r\n            //获取未读消息\r\n            unreadMsgCount(user){\r\n                let unread = 0; \r\n\r\n                if(this.currentId == user.id) return 0;\r\n\r\n                user.msgLst.forEach((v)=>{\r\n                    if(!v.read){\r\n                        unread++;\r\n                    }\r\n                });\r\n                \r\n                return unread;\r\n            },\r\n            //标准当前用户\r\n            currentUserStyle(id){\r\n                if(this.currentId == id){\r\n                    return {color:'red'};\r\n                }\r\n                return {};\r\n            },\r\n            //发送消息\r\n            inputMessage () {\r\n\r\n                if(this.inputMsg == '') {\r\n                    this.$Message.warning('不能发送空消息');\r\n                    return false;\r\n                }\r\n\r\n                socket.request('message.send',{\r\n                    from:this.userInfo.id,\r\n                    to:this.userInfo.friendLst[this.currentIndex].id,\r\n                    content:this.inputMsg\r\n                },(msg)=>{\r\n                   \r\n                });\r\n\r\n                this.userInfo.friendLst[this.currentIndex].msgLst.push(\r\n                    {\r\n                        ismster:true,user:this.userInfo,\r\n                        content:{\r\n                            text:this.inputMsg\r\n                        }\r\n                    }\r\n                );\r\n                this.inputMsg = '';\r\n            },\r\n            //选择用户\r\n            selectUser(user){\r\n                this.currentId = user.id;\r\n                this.isActive = true;\r\n                console.log(this.currentId);\r\n            }\r\n        }\r\n    }\r\n</script>\r\n\n\n\n// WEBPACK FOOTER //\n// message.vue?0682280d","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/_extract-text-webpack-plugin@2.1.2@extract-text-webpack-plugin/loader.js?{\"omit\":1,\"remove\":true}!./~/_vue-style-loader@1.0.0@vue-style-loader!./~/_css-loader@0.23.1@css-loader?minimize!./~/_vue-loader@11.3.4@vue-loader/lib/style-compiler?{\"id\":\"data-v-4e0c4c68\",\"scoped\":true,\"hasInlineConfig\":false}!./~/_autoprefixer-loader@2.1.0@autoprefixer-loader!./~/_less-loader@2.2.3@less-loader!./~/_vue-loader@11.3.4@vue-loader/lib/selector.js?type=styles&index=0!./~/_iview-loader@1.0.0@iview-loader?{\"prefix\":false}!./src/views/message.vue\n// module id = 43\n// module chunks = 4","module.exports={render:function (){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;\n  return _c('div', {\n    staticClass: \"message\"\n  }, [_c('div', {\n    staticClass: \"msg-list-swrip\"\n  }, [_c('div', {\n    staticClass: \"msg-list\"\n  }, [_c('ul', [_c('li', {\n    staticClass: \"search\"\n  }, [_c('AutoComplete', {\n    attrs: {\n      \"icon\": \"search\",\n      \"placeholder\": \"搜索\"\n    },\n    on: {\n      \"on-search\": _vm.handleSearch,\n      \"on-select\": _vm.selectFriend\n    },\n    model: {\n      value: (_vm.search),\n      callback: function($$v) {\n        _vm.search = $$v\n      },\n      expression: \"search\"\n    }\n  }, [_vm._l((_vm.searchLst), function(friend) {\n    return _c('Option', {\n      key: friend.id,\n      staticClass: \"optionSearch\",\n      attrs: {\n        \"value\": friend.nickname\n      }\n    }, [_c('span', {\n      staticClass: \"complete-title\"\n    }, [_vm._v(_vm._s(friend.nickname))]), _vm._v(\" \"), _c('span', {\n      staticClass: \"complete-add\",\n      on: {\n        \"click\": _vm.addFriend\n      }\n    }, [_c('Icon', {\n      attrs: {\n        \"type\": \"plus-round\"\n      }\n    })], 1)])\n  }), _vm._v(\" \"), _c('a', {\n    staticClass: \"biao\",\n    attrs: {\n      \"target\": \"_blank\"\n    }\n  }, [_vm._v(\"好友搜索\")])], 2)], 1), _vm._v(\" \"), _vm._l((_vm.userInfo.friendLst), function(user) {\n    return (user.id != _vm.userInfo.id) ? _c('li', {\n      style: (_vm.currentUserStyle(user.id)),\n      on: {\n        \"click\": function($event) {\n          _vm.selectUser(user)\n        }\n      }\n    }, [_c('Avatar', {\n      attrs: {\n        \"src\": \"https://i.loli.net/2017/08/21/599a521472424.jpg\"\n      }\n    }), _vm._v(\"\\n                  \" + _vm._s(user.nickname) + \"\\n                \"), _c('Badge', {\n      staticClass: \"demo-badge-alone\",\n      attrs: {\n        \"count\": _vm.unreadMsgCount(user)\n      }\n    })], 1) : _vm._e()\n  })], 2)])]), _vm._v(\" \"), (_vm.isActive == true) ? _c('div', {\n    staticClass: \"msg-window\"\n  }, [_c('Scroll', {\n    staticClass: \"chat\",\n    style: ({\n      background: '#fff',\n      marginBottom: '10px'\n    }),\n    attrs: {\n      \"height\": 400\n    }\n  }, [_c('ul', _vm._l((_vm.getUserMsg), function(msg) {\n    return _c('li', {\n      class: msg.ismster ? 'slef-mode' : 'msg-mode'\n    }, [_c('div', {\n      staticClass: \"user-info\"\n    }, [_c('Avatar', {\n      attrs: {\n        \"src\": \"https://i.loli.net/2017/08/21/599a521472424.jpg\"\n      }\n    }), _vm._v(\"  \" + _vm._s(msg.user.nickname) + \"  \")], 1), _vm._v(\" \"), _c('div', {\n      staticClass: \"msg-content\",\n      attrs: {\n        \"data\": msg.read = true\n      }\n    }, [_vm._v(\"\\n                    \" + _vm._s(msg.content.text) + \" \\n                    \"), _vm._l((msg.content.imgs), function(img) {\n      return _c('img', {\n        attrs: {\n          \"width\": \"300\",\n          \"src\": img\n        }\n      })\n    })], 2)])\n  }))]), _vm._v(\" \"), _c('Input', {\n    staticStyle: {\n      \"width\": \"300px\"\n    },\n    attrs: {\n      \"placeholder\": \"输入发送内容\",\n      \"clearable\": \"\"\n    },\n    on: {\n      \"on-enter\": _vm.inputMessage\n    },\n    model: {\n      value: (_vm.inputMsg),\n      callback: function($$v) {\n        _vm.inputMsg = $$v\n      },\n      expression: \"inputMsg\"\n    }\n  }), _vm._v(\" \"), _c('i-button', {\n    attrs: {\n      \"type\": \"primary\",\n      \"shape\": \"circle\"\n    }\n  }, [_vm._v(\"发送\")])], 1) : _c('div', {\n    staticClass: \"msg-window\"\n  })])\n},staticRenderFns: []}\nmodule.exports.render._withStripped = true\nif (module.hot) {\n  module.hot.accept()\n  if (module.hot.data) {\n     require(\"vue-loader/node_modules/vue-hot-reload-api\").rerender(\"data-v-4e0c4c68\", module.exports)\n  }\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/_vue-loader@11.3.4@vue-loader/lib/template-compiler?{\"id\":\"data-v-4e0c4c68\"}!./~/_vue-loader@11.3.4@vue-loader/lib/selector.js?type=template&index=0!./~/_iview-loader@1.0.0@iview-loader?{\"prefix\":false}!./src/views/message.vue\n// module id = 53\n// module chunks = 4"],"sourceRoot":""}